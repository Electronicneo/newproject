import { Injectable } from '@angular/core';
import { localStorangeACLKey, allowed } from './access-checker-key';
import * as jsonQuery from 'json-query';
import { selectWorkspace, selectPage, } from '../store/shared.selectors';
import { setPage, setWorkSpace, setLocaleInfo } from '../store/shared.actions';
import * as i0 from "@angular/core";
import * as i1 from "@ngrx/store";
export class AccessCheckerService {
    constructor(store$) {
        this.store$ = store$;
        this.workspaceSelected = null;
        this.pageId = null;
        this.workspaceSelected$ = this.store$.select(selectWorkspace);
        this.page$ = this.store$.select(selectPage);
        this.workspaceSelected$.subscribe(ws => this.workspaceSelected = ws);
        this.page$.subscribe(page => this.pageId = page);
    }
    clearACLLocalStorage() {
        localStorage.removeItem(localStorangeACLKey);
    }
    setWorkSpaceSelected(workspaceId) {
        this.store$.dispatch(setWorkSpace({ workspaceID: workspaceId }));
    }
    getWorkSpaceSelected() {
        return this.workspaceSelected;
    }
    setPageSelected(pageId) {
        this.store$.dispatch(setPage({ pageID: pageId }));
    }
    setLocaleCode(languageCode, countryCode, timezoneCode) {
        this.store$.dispatch(setLocaleInfo({ languageCode: languageCode, countryCode: countryCode, timezoneCode: timezoneCode }));
    }
    isFeatureRouteGranted(featureLabel) {
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_PAGES`];
        if (serviceList && serviceList.length > 0 && (this.checkSpecialSelect(serviceList) || serviceList.filter(service => service.label.toLowerCase() == featureLabel.toLowerCase()).length > 0)) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    isPageRouteGranted(pageId) {
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_PAGESCOMP`];
        if (serviceList && serviceList.length > 0 && serviceList.filter(service => service.keyUuid == pageId).length > 0) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    isWidgetGrantedByLabel(serviceLabel, pageId, widgetId) {
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_${pageId}_${widgetId}_SERVICESWIDGET`];
        if (serviceList && serviceList.length > 0 && (this.checkSpecialSelect(serviceList) || serviceList.filter(service => service.label == serviceLabel).length > 0)) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    isPageGrantedByLabel(serviceLabel, pageId) {
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_${pageId}_SERVICESPAGESCOMP`];
        if (serviceList && serviceList.length > 0 && (this.checkSpecialSelect(serviceList) || serviceList.filter(service => service.label == serviceLabel).length > 0)) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    isWidgetGrantedById(serviceId, pageId, widgetId) {
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_${pageId}_${widgetId}_SERVICESWIDGET`];
        if (serviceList && serviceList.length > 0 && (this.checkSpecialSelect(serviceList) || serviceList.filter(service => service.keyUuid == serviceId).length > 0)) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    isFeatureGrantedById(serviceId) {
        if (!this.workspaceSelected) {
            return false;
        }
        if (this.checkSpecialSelect(this.getPemissions()[`${this.workspaceSelected}_PAGES`])) {
            return true;
        }
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_${this.pageId}_SERVICESPAGES`];
        if (serviceList && serviceList.length > 0 && (this.checkSpecialSelect(serviceList) || serviceList.filter(service => service.keyUuid == serviceId).length > 0)) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    isFeatureGrantedByLabel(serviceLabel) {
        if (!this.workspaceSelected) {
            return false;
        }
        if (this.checkSpecialSelect(this.getPemissions()[`${this.workspaceSelected}_PAGES`])) {
            return true;
        }
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_${this.pageId}_SERVICESPAGES`];
        if (serviceList && serviceList.length > 0 && (this.checkSpecialSelect(serviceList) || serviceList.filter(service => service.label == serviceLabel).length > 0)) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    isPageGrantedById(serviceId) {
        let result;
        let serviceList = [];
        serviceList = this.getPemissions()[`${this.workspaceSelected}_${this.pageId}_SERVICESPAGESCOMP`];
        if (serviceList && serviceList.length > 0 && (this.checkSpecialSelect(serviceList) || serviceList.filter(service => service.keyUuid == serviceId).length > 0)) {
            result = true;
        }
        else {
            result = false;
        }
        return result;
    }
    generateFeatureSecurityParamBody(resourceId) {
        let result = {};
        result['context'] = {};
        let userContextMetadata = result['context']['userContextMetadata'] = {};
        userContextMetadata['username'] = this.getUserName();
        userContextMetadata['authPermissionPath'] = `${this.workspaceSelected}_${this.pageId}_SERVICESPAGES`;
        userContextMetadata['resourceId'] = resourceId;
        userContextMetadata['parentType'] = 'PAGES';
        return result;
    }
    generateFeatureSecurityParamBodyByLabel(resourceLabel) {
        let result = {};
        result['context'] = {};
        let userContextMetadata = result['context']['userContextMetadata'] = {};
        const serviceList = this.getPemissions()[`${this.workspaceSelected}_${this.pageId}_SERVICESPAGES`];
        let serviceItem = serviceList != null ? serviceList.find(service => service.label == resourceLabel) : null;
        userContextMetadata['username'] = this.getUserName();
        userContextMetadata['authPermissionPath'] = `${this.workspaceSelected}_${this.pageId}_SERVICESPAGES`;
        userContextMetadata['resourceId'] = serviceItem != null ? serviceItem.keyUuid : '';
        userContextMetadata['parentType'] = 'PAGES';
        return result;
    }
    generateComposerPageSecurityParamBody(resourceId) {
        let result = {};
        result['context'] = {};
        let userContextMetadata = result['context']['userContextMetadata'] = {};
        userContextMetadata['username'] = this.getUserName();
        userContextMetadata['authPermissionPath'] = `${this.workspaceSelected}_${this.pageId}SERVICESPAGESCOMP`;
        userContextMetadata['resourceId'] = resourceId;
        userContextMetadata['parentType'] = 'PAGESCOMP';
        return result;
    }
    getAuthPermissionPath() {
        return `${this.workspaceSelected}_${this.pageId}`;
    }
    getWorkSpace() {
        return this.workspaceSelected;
    }
    getWorkPage() {
        return this.pageId;
    }
    getPemissions() {
        return this.getACL().authPermissions;
    }
    getWorkSpaces() {
        return this.getPemissions().WORKSPACE;
    }
    getFullName() {
        return this.getACL().fullName;
    }
    // sta fuori dal contesto
    getRoleName() {
        return this.getACL().nomeRuolo;
    }
    getUserName() {
        return this.getACL().userName;
    }
    getNodeBreadcrumb() {
        return this.getACL().nodeBreadcrumb;
    }
    getRootName() {
        return this.getACL().rootName;
    }
    getUserUUID() {
        return this.getACL().userUuid;
    }
    getKeyOid() {
        return this.getACL().keyOid;
    }
    getEnablingUuid() {
        return this.getACL().enablingUuid;
    }
    getLanguageCode() {
        return this.getACL().languageCode;
    }
    getCountryCode() {
        return this.getACL().countryCode;
    }
    getTimeZoneCode() {
        return this.getACL().timeZoneCode;
    }
    getACL() {
        return JSON.parse(localStorage.getItem(localStorangeACLKey));
    }
    setACLLocalStorage(revoContext) {
        localStorage.setItem(localStorangeACLKey, JSON.stringify(this.createUserInfo(revoContext)));
    }
    createUserInfo(revoContext) {
        const userContextMetadata = revoContext.context.userContextMetadata;
        const context = revoContext.context;
        const permissionsAndUserInfo = {
            authPermissions: JSON.parse(userContextMetadata.authPermissions),
            keyOid: userContextMetadata.keyOid,
            rootName: userContextMetadata.rootName,
            userUuid: userContextMetadata.userUuid,
            fullName: userContextMetadata.fullName,
            userName: context.userName,
            nomeRuolo: context.nomeRuolo,
            nodeBreadcrumb: userContextMetadata.nodeBreadcrumb,
            enablingUuid: userContextMetadata.enablingUuid,
            countryCode: userContextMetadata.countryCode,
            languageCode: userContextMetadata.languageCode,
            timeZoneCode: userContextMetadata.timeZoneCode
        };
        return permissionsAndUserInfo;
    }
    /*   public setPermissionsAndUserInfo(userInfo: IUserInfo) {
        this.store$.dispatch(setPermissionsAndUserInfo({ userInfo: userInfo }));
      } */
    setNewToken(token) {
        const tokenInfo = {
            createdAt: new Date().getTime(),
            name: "nb:auth:simple:token",
            ownerStrategyName: "username",
            value: token,
        };
        localStorage.setItem('auth_app_token', JSON.stringify(tokenInfo));
    }
    getFeatureIdByFeatureLabel(featureLabel) {
        let result = jsonQuery.default(`${this.workspaceSelected}_PAGES[label=${featureLabel}].keyUuid`, {
            data: this.getPemissions()
        });
        return result.value;
    }
    checkSpecialSelect(serviceList) {
        return allowed.includes(serviceList[0].label);
    }
}
/** @nocollapse */ AccessCheckerService.ɵfac = function AccessCheckerService_Factory(t) { return new (t || AccessCheckerService)(i0.ɵɵinject(i1.Store)); };
/** @nocollapse */ AccessCheckerService.ɵprov = i0.ɵɵdefineInjectable({ token: AccessCheckerService, factory: AccessCheckerService.ɵfac, providedIn: 'root' });
/*@__PURE__*/ (function () { i0.ɵsetClassMetadata(AccessCheckerService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: i1.Store }]; }, null); })();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWNjZXNzLWNoZWNrZXIuc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3NoYXJlZC8iLCJzb3VyY2VzIjpbImxpYi9hY2Nlc3MtY2hlY2tlci9hY2Nlc3MtY2hlY2tlci5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE9BQU8sRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ3BFLE9BQU8sS0FBSyxTQUFTLE1BQU0sWUFBWSxDQUFBO0FBRXZDLE9BQU8sRUFBa0IsZUFBZSxFQUFFLFVBQVUsR0FBSyxNQUFNLDJCQUEyQixDQUFDO0FBQzNGLE9BQU8sRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLGFBQWEsRUFBQyxNQUFNLHlCQUF5QixDQUFDOzs7QUFhOUUsTUFBTSxPQUFPLG9CQUFvQjtJQVkvQixZQUFzQixNQUE2QjtRQUE3QixXQUFNLEdBQU4sTUFBTSxDQUF1QjtRQVYzQyxzQkFBaUIsR0FBVyxJQUFJLENBQUM7UUFFakMsV0FBTSxHQUFXLElBQUksQ0FBQztRQUU5Qix1QkFBa0IsR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQztRQUV6RCxVQUFLLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUM7UUFPckMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUVyRSxJQUFJLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsSUFBSSxDQUFDLENBQUM7SUFHbkQsQ0FBQztJQUdELG9CQUFvQjtRQUVsQixZQUFZLENBQUMsVUFBVSxDQUFDLG1CQUFtQixDQUFDLENBQUM7SUFDL0MsQ0FBQztJQUVNLG9CQUFvQixDQUFDLFdBQW1CO1FBQzdDLElBQUksQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxFQUFFLFdBQVcsRUFBRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDbkUsQ0FBQztJQUVNLG9CQUFvQjtRQUN6QixPQUFPLElBQUksQ0FBQyxpQkFBaUIsQ0FBQTtJQUMvQixDQUFDO0lBR00sZUFBZSxDQUFDLE1BQWM7UUFDbkMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBRU0sYUFBYSxDQUFDLFlBQXFCLEVBQUMsV0FBb0IsRUFBRSxZQUFxQjtRQUNwRixJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsRUFBRSxZQUFZLEVBQUUsWUFBWSxFQUFJLFdBQVcsRUFBRyxXQUFXLEVBQUcsWUFBWSxFQUFHLFlBQVksRUFBQyxDQUFDLENBQUMsQ0FBQztJQUNoSSxDQUFDO0lBRU0scUJBQXFCLENBQUMsWUFBb0I7UUFDL0MsSUFBSSxNQUFlLENBQUE7UUFDbkIsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLFFBQVEsQ0FBQyxDQUFDO1FBRXRFLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsRUFBRSxJQUFJLFlBQVksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRTtZQUMxTCxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ2Y7YUFBTTtZQUNMLE1BQU0sR0FBRyxLQUFLLENBQUM7U0FDaEI7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUVoQixDQUFDO0lBRU0sa0JBQWtCLENBQUMsTUFBYztRQUN0QyxJQUFJLE1BQWUsQ0FBQTtRQUNuQixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDckIsV0FBVyxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsWUFBWSxDQUFDLENBQUM7UUFFMUUsSUFBSSxXQUFXLElBQUksV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxPQUFPLElBQUksTUFBTSxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNoSCxNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ2Y7YUFBTTtZQUNMLE1BQU0sR0FBRyxLQUFLLENBQUM7U0FDaEI7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUVoQixDQUFDO0lBRU0sc0JBQXNCLENBQUMsWUFBb0IsRUFBRSxNQUFjLEVBQUUsUUFBZ0I7UUFDbEYsSUFBSSxNQUFlLENBQUE7UUFDbkIsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksTUFBTSxJQUFJLFFBQVEsaUJBQWlCLENBQUMsQ0FBQztRQUNyRyxJQUFJLFdBQVcsSUFBSSxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsSUFBSSxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssSUFBSSxZQUFZLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDOUosTUFBTSxHQUFHLElBQUksQ0FBQztTQUNmO2FBQU07WUFDTCxNQUFNLEdBQUcsS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFFaEIsQ0FBQztJQUlNLG9CQUFvQixDQUFDLFlBQW9CLEVBQUUsTUFBYztRQUM5RCxJQUFJLE1BQWUsQ0FBQTtRQUNuQixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDckIsV0FBVyxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxNQUFNLG9CQUFvQixDQUFDLENBQUM7UUFFNUYsSUFBSSxXQUFXLElBQUksV0FBVyxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsV0FBVyxDQUFDLElBQUksV0FBVyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLElBQUksWUFBWSxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxFQUFFO1lBQzlKLE1BQU0sR0FBRyxJQUFJLENBQUM7U0FDZjthQUFNO1lBQ0wsTUFBTSxHQUFHLEtBQUssQ0FBQztTQUNoQjtRQUNELE9BQU8sTUFBTSxDQUFDO0lBRWhCLENBQUM7SUFHTSxtQkFBbUIsQ0FBQyxTQUFpQixFQUFFLE1BQWMsRUFBRSxRQUFnQjtRQUM1RSxJQUFJLE1BQWUsQ0FBQTtRQUNuQixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDckIsV0FBVyxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxNQUFNLElBQUksUUFBUSxpQkFBaUIsQ0FBQyxDQUFDO1FBQ3JHLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxJQUFJLFNBQVMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRTtZQUM3SixNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ2Y7YUFBTTtZQUNMLE1BQU0sR0FBRyxLQUFLLENBQUM7U0FDaEI7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUVoQixDQUFDO0lBRU0sb0JBQW9CLENBQUMsU0FBaUI7UUFDM0MsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtZQUFFLE9BQU8sS0FBSyxDQUFDO1NBQUU7UUFDOUMsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixRQUFRLENBQUMsQ0FBQyxFQUFFO1lBQUUsT0FBTyxJQUFJLENBQUE7U0FBRTtRQUNyRyxJQUFJLE1BQWUsQ0FBQTtRQUNuQixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDckIsV0FBVyxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsTUFBTSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzdGLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsT0FBTyxJQUFJLFNBQVMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRTtZQUM3SixNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ2Y7YUFBTTtZQUNMLE1BQU0sR0FBRyxLQUFLLENBQUM7U0FDaEI7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRU0sdUJBQXVCLENBQUMsWUFBb0I7UUFFakQsSUFBSSxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRTtZQUFFLE9BQU8sS0FBSyxDQUFDO1NBQUU7UUFDOUMsSUFBSSxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixRQUFRLENBQUMsQ0FBQyxFQUFFO1lBQUUsT0FBTyxJQUFJLENBQUE7U0FBRTtRQUNyRyxJQUFJLE1BQWUsQ0FBQTtRQUNuQixJQUFJLFdBQVcsR0FBRyxFQUFFLENBQUM7UUFDckIsV0FBVyxHQUFHLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxpQkFBaUIsSUFBSSxJQUFJLENBQUMsTUFBTSxnQkFBZ0IsQ0FBQyxDQUFDO1FBQzdGLElBQUksV0FBVyxJQUFJLFdBQVcsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQyxJQUFJLFdBQVcsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxPQUFPLENBQUMsS0FBSyxJQUFJLFlBQVksQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsRUFBRTtZQUM5SixNQUFNLEdBQUcsSUFBSSxDQUFDO1NBQ2Y7YUFBTTtZQUNMLE1BQU0sR0FBRyxLQUFLLENBQUM7U0FDaEI7UUFDRCxPQUFPLE1BQU0sQ0FBQztJQUVoQixDQUFDO0lBRU0saUJBQWlCLENBQUMsU0FBaUI7UUFDeEMsSUFBSSxNQUFlLENBQUE7UUFDbkIsSUFBSSxXQUFXLEdBQUcsRUFBRSxDQUFDO1FBQ3JCLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLE1BQU0sb0JBQW9CLENBQUMsQ0FBQztRQUVqRyxJQUFJLFdBQVcsSUFBSSxXQUFXLENBQUMsTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLENBQUMsSUFBSSxXQUFXLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLE9BQU8sSUFBSSxTQUFTLENBQUMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEVBQUU7WUFDN0osTUFBTSxHQUFHLElBQUksQ0FBQztTQUNmO2FBQU07WUFDTCxNQUFNLEdBQUcsS0FBSyxDQUFDO1NBQ2hCO1FBQ0QsT0FBTyxNQUFNLENBQUM7SUFFaEIsQ0FBQztJQUVELGdDQUFnQyxDQUFDLFVBQWtCO1FBRWpELElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQTtRQUNmLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBSSxtQkFBbUIsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMscUJBQXFCLENBQUMsR0FBRyxFQUFFLENBQUM7UUFHeEUsbUJBQW1CLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JELG1CQUFtQixDQUFDLG9CQUFvQixDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLE1BQU0sZ0JBQWdCLENBQUM7UUFDckcsbUJBQW1CLENBQUMsWUFBWSxDQUFDLEdBQUcsVUFBVSxDQUFDO1FBQy9DLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxHQUFHLE9BQU8sQ0FBQztRQUU1QyxPQUFPLE1BQU0sQ0FBQztJQUVoQixDQUFDO0lBRUQsdUNBQXVDLENBQUMsYUFBcUI7UUFDM0QsSUFBSSxNQUFNLEdBQUcsRUFBRSxDQUFBO1FBQ2YsTUFBTSxDQUFDLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUN2QixJQUFJLG1CQUFtQixHQUFHLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxxQkFBcUIsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUV4RSxNQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLE1BQU0sZ0JBQWdCLENBQUMsQ0FBQztRQUVuRyxJQUFJLFdBQVcsR0FBRyxXQUFXLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxDQUFDLEtBQUssSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO1FBQzNHLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxHQUFHLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNyRCxtQkFBbUIsQ0FBQyxvQkFBb0IsQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixJQUFJLElBQUksQ0FBQyxNQUFNLGdCQUFnQixDQUFDO1FBQ3JHLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxHQUFHLFdBQVcsSUFBSSxJQUFJLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztRQUNuRixtQkFBbUIsQ0FBQyxZQUFZLENBQUMsR0FBRyxPQUFPLENBQUM7UUFFNUMsT0FBTyxNQUFNLENBQUM7SUFFaEIsQ0FBQztJQUVELHFDQUFxQyxDQUFDLFVBQWtCO1FBRXRELElBQUksTUFBTSxHQUFHLEVBQUUsQ0FBQTtRQUNmLE1BQU0sQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDdkIsSUFBSSxtQkFBbUIsR0FBRyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMscUJBQXFCLENBQUMsR0FBRyxFQUFFLENBQUM7UUFFeEUsbUJBQW1CLENBQUMsVUFBVSxDQUFDLEdBQUcsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQ3JELG1CQUFtQixDQUFDLG9CQUFvQixDQUFDLEdBQUcsR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLE1BQU0sbUJBQW1CLENBQUM7UUFDeEcsbUJBQW1CLENBQUMsWUFBWSxDQUFDLEdBQUcsVUFBVSxDQUFDO1FBQy9DLG1CQUFtQixDQUFDLFlBQVksQ0FBQyxHQUFHLFdBQVcsQ0FBQztRQUVoRCxPQUFPLE1BQU0sQ0FBQztJQUVoQixDQUFDO0lBRUQscUJBQXFCO1FBRW5CLE9BQU8sR0FBRyxJQUFJLENBQUMsaUJBQWlCLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0lBRXBELENBQUM7SUFFTSxZQUFZO1FBQ2pCLE9BQU8sSUFBSSxDQUFDLGlCQUFpQixDQUFDO0lBQ2hDLENBQUM7SUFFTSxXQUFXO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztJQUNyQixDQUFDO0lBR00sYUFBYTtRQUNsQixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxlQUFlLENBQUM7SUFDdkMsQ0FBQztJQUVNLGFBQWE7UUFDbEIsT0FBTyxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUMsU0FBUyxDQUFDO0lBQ3hDLENBQUM7SUFLTSxXQUFXO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQztJQUNoQyxDQUFDO0lBQ0QseUJBQXlCO0lBQ2xCLFdBQVc7UUFDaEIsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsU0FBUyxDQUFDO0lBQ2pDLENBQUM7SUFFTSxXQUFXO1FBQ2hCLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFFBQVEsQ0FBQztJQUNoQyxDQUFDO0lBRU0saUJBQWlCO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLGNBQWMsQ0FBQztJQUN0QyxDQUFDO0lBRU0sV0FBVztRQUNoQixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxRQUFRLENBQUM7SUFDaEMsQ0FBQztJQUVNLFdBQVc7UUFDaEIsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsUUFBUSxDQUFDO0lBQ2hDLENBQUM7SUFFTSxTQUFTO1FBQ2QsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsTUFBTSxDQUFDO0lBQzlCLENBQUM7SUFLTSxlQUFlO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFlBQVksQ0FBQztJQUNwQyxDQUFDO0lBRU0sZUFBZTtRQUNwQixPQUFPLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQyxZQUFZLENBQUM7SUFDcEMsQ0FBQztJQUVNLGNBQWM7UUFDbkIsT0FBTyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsV0FBVyxDQUFDO0lBQ25DLENBQUM7SUFFTSxlQUFlO1FBQ3BCLE9BQU8sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDLFlBQVksQ0FBQztJQUNwQyxDQUFDO0lBSU0sTUFBTTtRQUNYLE9BQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRU0sa0JBQWtCLENBQUMsV0FBZ0I7UUFHeEMsWUFBWSxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzlGLENBQUM7SUFHTyxjQUFjLENBQUMsV0FBZ0I7UUFFckMsTUFBTSxtQkFBbUIsR0FBRyxXQUFXLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDO1FBQ3BFLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxPQUFPLENBQUM7UUFHcEMsTUFBTSxzQkFBc0IsR0FBYztZQUV4QyxlQUFlLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxlQUFlLENBQUM7WUFDaEUsTUFBTSxFQUFFLG1CQUFtQixDQUFDLE1BQU07WUFDbEMsUUFBUSxFQUFFLG1CQUFtQixDQUFDLFFBQVE7WUFDdEMsUUFBUSxFQUFFLG1CQUFtQixDQUFDLFFBQVE7WUFDdEMsUUFBUSxFQUFFLG1CQUFtQixDQUFDLFFBQVE7WUFDdEMsUUFBUSxFQUFFLE9BQU8sQ0FBQyxRQUFRO1lBQzFCLFNBQVMsRUFBRSxPQUFPLENBQUMsU0FBUztZQUM1QixjQUFjLEVBQUUsbUJBQW1CLENBQUMsY0FBYztZQUNsRCxZQUFZLEVBQUcsbUJBQW1CLENBQUMsWUFBWTtZQUMvQyxXQUFXLEVBQUksbUJBQW1CLENBQUMsV0FBVztZQUM5QyxZQUFZLEVBQUcsbUJBQW1CLENBQUMsWUFBWTtZQUMvQyxZQUFZLEVBQUksbUJBQW1CLENBQUMsWUFBWTtTQUVqRCxDQUFBO1FBRUQsT0FBTyxzQkFBc0IsQ0FBQztJQUVoQyxDQUFDO0lBSUg7O1VBRU07SUFFRyxXQUFXLENBQUMsS0FBYTtRQUU5QixNQUFNLFNBQVMsR0FBRztZQUNoQixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUUsQ0FBQyxPQUFPLEVBQUU7WUFDL0IsSUFBSSxFQUFFLHNCQUFzQjtZQUM1QixpQkFBaUIsRUFBRSxVQUFVO1lBQzdCLEtBQUssRUFBRSxLQUFLO1NBQ2IsQ0FBQTtRQUVELFlBQVksQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0lBQ3BFLENBQUM7SUFLTywwQkFBMEIsQ0FBQyxZQUFvQjtRQUNyRCxJQUFJLE1BQU0sR0FBRyxTQUFTLENBQUMsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixnQkFBZ0IsWUFBWSxXQUFXLEVBQUU7WUFDL0YsSUFBSSxFQUFFLElBQUksQ0FBQyxhQUFhLEVBQUU7U0FDM0IsQ0FBQyxDQUFBO1FBRUYsT0FBTyxNQUFNLENBQUMsS0FBSyxDQUFDO0lBQ3RCLENBQUM7SUFFTyxrQkFBa0IsQ0FBQyxXQUFrQjtRQUMzQyxPQUFPLE9BQU8sQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDO0lBQ2hELENBQUM7OzJHQWhXVSxvQkFBb0I7K0VBQXBCLG9CQUFvQixXQUFwQixvQkFBb0IsbUJBRm5CLE1BQU07a0RBRVAsb0JBQW9CO2NBSGhDLFVBQVU7ZUFBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcclxuaW1wb3J0IHsgbG9jYWxTdG9yYW5nZUFDTEtleSwgYWxsb3dlZCB9IGZyb20gJy4vYWNjZXNzLWNoZWNrZXIta2V5JztcclxuaW1wb3J0ICogYXMganNvblF1ZXJ5IGZyb20gJ2pzb24tcXVlcnknXHJcbmltcG9ydCB7IFN0b3JlIH0gZnJvbSAnQG5ncngvc3RvcmUnO1xyXG5pbXBvcnQgeyBBcHBTaGFyZWRTdGF0ZSwgc2VsZWN0V29ya3NwYWNlLCBzZWxlY3RQYWdlICwgIH0gZnJvbSAnLi4vc3RvcmUvc2hhcmVkLnNlbGVjdG9ycyc7XHJcbmltcG9ydCB7IHNldFBhZ2UsIHNldFdvcmtTcGFjZSAsc2V0TG9jYWxlSW5mb30gZnJvbSAnLi4vc3RvcmUvc2hhcmVkLmFjdGlvbnMnO1xyXG5pbXBvcnQgeyBBQ0wgfSBmcm9tICcuL21vZGVsL0FDTC5pbnRlcmZhY2UnXHJcblxyXG5pbXBvcnQgeyBJVXNlckluZm8gfSBmcm9tICcuLi9hY2Nlc3MtY2hlY2tlci9tb2RlbC91c2VySW5mby5pbnRlcmZhY2UnO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5ASW5qZWN0YWJsZSh7XHJcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXHJcbn0pXHJcbmV4cG9ydCBjbGFzcyBBY2Nlc3NDaGVja2VyU2VydmljZSB7XHJcblxyXG4gIHByaXZhdGUgd29ya3NwYWNlU2VsZWN0ZWQ6IHN0cmluZyA9IG51bGw7XHJcblxyXG4gIHByaXZhdGUgcGFnZUlkOiBzdHJpbmcgPSBudWxsO1xyXG5cclxuICB3b3Jrc3BhY2VTZWxlY3RlZCQgPSB0aGlzLnN0b3JlJC5zZWxlY3Qoc2VsZWN0V29ya3NwYWNlKTtcclxuXHJcbiAgcGFnZSQgPSB0aGlzLnN0b3JlJC5zZWxlY3Qoc2VsZWN0UGFnZSk7XHJcblxyXG5cclxuXHJcbiAgY29uc3RydWN0b3IocHJvdGVjdGVkIHN0b3JlJDogU3RvcmU8QXBwU2hhcmVkU3RhdGU+KSB7XHJcblxyXG5cclxuICAgIHRoaXMud29ya3NwYWNlU2VsZWN0ZWQkLnN1YnNjcmliZSh3cyA9PiB0aGlzLndvcmtzcGFjZVNlbGVjdGVkID0gd3MpO1xyXG5cclxuICAgIHRoaXMucGFnZSQuc3Vic2NyaWJlKHBhZ2UgPT4gdGhpcy5wYWdlSWQgPSBwYWdlKTtcclxuXHJcblxyXG4gIH1cclxuXHJcblxyXG4gIGNsZWFyQUNMTG9jYWxTdG9yYWdlKCkge1xyXG5cclxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGxvY2FsU3RvcmFuZ2VBQ0xLZXkpO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIHNldFdvcmtTcGFjZVNlbGVjdGVkKHdvcmtzcGFjZUlkOiBzdHJpbmcpIHtcclxuICAgIHRoaXMuc3RvcmUkLmRpc3BhdGNoKHNldFdvcmtTcGFjZSh7IHdvcmtzcGFjZUlEOiB3b3Jrc3BhY2VJZCB9KSk7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0V29ya1NwYWNlU2VsZWN0ZWQoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLndvcmtzcGFjZVNlbGVjdGVkXHJcbiAgfVxyXG5cclxuXHJcbiAgcHVibGljIHNldFBhZ2VTZWxlY3RlZChwYWdlSWQ6IHN0cmluZykge1xyXG4gICAgdGhpcy5zdG9yZSQuZGlzcGF0Y2goc2V0UGFnZSh7IHBhZ2VJRDogcGFnZUlkIH0pKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRMb2NhbGVDb2RlKGxhbmd1YWdlQ29kZSA6IHN0cmluZyxjb3VudHJ5Q29kZSA6IHN0cmluZywgdGltZXpvbmVDb2RlICA6c3RyaW5nKSB7XHJcbiAgICB0aGlzLnN0b3JlJC5kaXNwYXRjaChzZXRMb2NhbGVJbmZvKHsgbGFuZ3VhZ2VDb2RlOiBsYW5ndWFnZUNvZGUgICwgY291bnRyeUNvZGUgOiBjb3VudHJ5Q29kZSAsIHRpbWV6b25lQ29kZSA6IHRpbWV6b25lQ29kZX0pKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0ZlYXR1cmVSb3V0ZUdyYW50ZWQoZmVhdHVyZUxhYmVsOiBzdHJpbmcpIHtcclxuICAgIGxldCByZXN1bHQ6IGJvb2xlYW5cclxuICAgIGxldCBzZXJ2aWNlTGlzdCA9IFtdO1xyXG4gICAgc2VydmljZUxpc3QgPSB0aGlzLmdldFBlbWlzc2lvbnMoKVtgJHt0aGlzLndvcmtzcGFjZVNlbGVjdGVkfV9QQUdFU2BdO1xyXG5cclxuICAgIGlmIChzZXJ2aWNlTGlzdCAmJiBzZXJ2aWNlTGlzdC5sZW5ndGggPiAwICYmICh0aGlzLmNoZWNrU3BlY2lhbFNlbGVjdChzZXJ2aWNlTGlzdCkgfHwgc2VydmljZUxpc3QuZmlsdGVyKHNlcnZpY2UgPT4gc2VydmljZS5sYWJlbC50b0xvd2VyQ2FzZSgpID09IGZlYXR1cmVMYWJlbC50b0xvd2VyQ2FzZSgpKS5sZW5ndGggPiAwKSkge1xyXG4gICAgICByZXN1bHQgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzdWx0ID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG5cclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc1BhZ2VSb3V0ZUdyYW50ZWQocGFnZUlkOiBzdHJpbmcpIHtcclxuICAgIGxldCByZXN1bHQ6IGJvb2xlYW5cclxuICAgIGxldCBzZXJ2aWNlTGlzdCA9IFtdO1xyXG4gICAgc2VydmljZUxpc3QgPSB0aGlzLmdldFBlbWlzc2lvbnMoKVtgJHt0aGlzLndvcmtzcGFjZVNlbGVjdGVkfV9QQUdFU0NPTVBgXTtcclxuXHJcbiAgICBpZiAoc2VydmljZUxpc3QgJiYgc2VydmljZUxpc3QubGVuZ3RoID4gMCAmJiBzZXJ2aWNlTGlzdC5maWx0ZXIoc2VydmljZSA9PiBzZXJ2aWNlLmtleVV1aWQgPT0gcGFnZUlkKS5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHJlc3VsdCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcblxyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzV2lkZ2V0R3JhbnRlZEJ5TGFiZWwoc2VydmljZUxhYmVsOiBzdHJpbmcsIHBhZ2VJZDogc3RyaW5nLCB3aWRnZXRJZDogc3RyaW5nKSB7XHJcbiAgICBsZXQgcmVzdWx0OiBib29sZWFuXHJcbiAgICBsZXQgc2VydmljZUxpc3QgPSBbXTtcclxuICAgIHNlcnZpY2VMaXN0ID0gdGhpcy5nZXRQZW1pc3Npb25zKClbYCR7dGhpcy53b3Jrc3BhY2VTZWxlY3RlZH1fJHtwYWdlSWR9XyR7d2lkZ2V0SWR9X1NFUlZJQ0VTV0lER0VUYF07XHJcbiAgICBpZiAoc2VydmljZUxpc3QgJiYgc2VydmljZUxpc3QubGVuZ3RoID4gMCAmJiAodGhpcy5jaGVja1NwZWNpYWxTZWxlY3Qoc2VydmljZUxpc3QpIHx8IHNlcnZpY2VMaXN0LmZpbHRlcihzZXJ2aWNlID0+IHNlcnZpY2UubGFiZWwgPT0gc2VydmljZUxhYmVsKS5sZW5ndGggPiAwKSkge1xyXG4gICAgICByZXN1bHQgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzdWx0ID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG5cclxuICB9XHJcblxyXG5cclxuXHJcbiAgcHVibGljIGlzUGFnZUdyYW50ZWRCeUxhYmVsKHNlcnZpY2VMYWJlbDogc3RyaW5nLCBwYWdlSWQ6IHN0cmluZykge1xyXG4gICAgbGV0IHJlc3VsdDogYm9vbGVhblxyXG4gICAgbGV0IHNlcnZpY2VMaXN0ID0gW107XHJcbiAgICBzZXJ2aWNlTGlzdCA9IHRoaXMuZ2V0UGVtaXNzaW9ucygpW2Ake3RoaXMud29ya3NwYWNlU2VsZWN0ZWR9XyR7cGFnZUlkfV9TRVJWSUNFU1BBR0VTQ09NUGBdO1xyXG5cclxuICAgIGlmIChzZXJ2aWNlTGlzdCAmJiBzZXJ2aWNlTGlzdC5sZW5ndGggPiAwICYmICh0aGlzLmNoZWNrU3BlY2lhbFNlbGVjdChzZXJ2aWNlTGlzdCkgfHwgc2VydmljZUxpc3QuZmlsdGVyKHNlcnZpY2UgPT4gc2VydmljZS5sYWJlbCA9PSBzZXJ2aWNlTGFiZWwpLmxlbmd0aCA+IDApKSB7XHJcbiAgICAgIHJlc3VsdCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcblxyXG4gIH1cclxuXHJcblxyXG4gIHB1YmxpYyBpc1dpZGdldEdyYW50ZWRCeUlkKHNlcnZpY2VJZDogc3RyaW5nLCBwYWdlSWQ6IHN0cmluZywgd2lkZ2V0SWQ6IHN0cmluZykge1xyXG4gICAgbGV0IHJlc3VsdDogYm9vbGVhblxyXG4gICAgbGV0IHNlcnZpY2VMaXN0ID0gW107XHJcbiAgICBzZXJ2aWNlTGlzdCA9IHRoaXMuZ2V0UGVtaXNzaW9ucygpW2Ake3RoaXMud29ya3NwYWNlU2VsZWN0ZWR9XyR7cGFnZUlkfV8ke3dpZGdldElkfV9TRVJWSUNFU1dJREdFVGBdO1xyXG4gICAgaWYgKHNlcnZpY2VMaXN0ICYmIHNlcnZpY2VMaXN0Lmxlbmd0aCA+IDAgJiYgKHRoaXMuY2hlY2tTcGVjaWFsU2VsZWN0KHNlcnZpY2VMaXN0KSB8fCBzZXJ2aWNlTGlzdC5maWx0ZXIoc2VydmljZSA9PiBzZXJ2aWNlLmtleVV1aWQgPT0gc2VydmljZUlkKS5sZW5ndGggPiAwKSkge1xyXG4gICAgICByZXN1bHQgPSB0cnVlO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzdWx0ID0gZmFsc2U7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG5cclxuICB9XHJcblxyXG4gIHB1YmxpYyBpc0ZlYXR1cmVHcmFudGVkQnlJZChzZXJ2aWNlSWQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgaWYgKCF0aGlzLndvcmtzcGFjZVNlbGVjdGVkKSB7IHJldHVybiBmYWxzZTsgfVxyXG4gICAgaWYgKHRoaXMuY2hlY2tTcGVjaWFsU2VsZWN0KHRoaXMuZ2V0UGVtaXNzaW9ucygpW2Ake3RoaXMud29ya3NwYWNlU2VsZWN0ZWR9X1BBR0VTYF0pKSB7IHJldHVybiB0cnVlIH1cclxuICAgIGxldCByZXN1bHQ6IGJvb2xlYW5cclxuICAgIGxldCBzZXJ2aWNlTGlzdCA9IFtdO1xyXG4gICAgc2VydmljZUxpc3QgPSB0aGlzLmdldFBlbWlzc2lvbnMoKVtgJHt0aGlzLndvcmtzcGFjZVNlbGVjdGVkfV8ke3RoaXMucGFnZUlkfV9TRVJWSUNFU1BBR0VTYF07XHJcbiAgICBpZiAoc2VydmljZUxpc3QgJiYgc2VydmljZUxpc3QubGVuZ3RoID4gMCAmJiAodGhpcy5jaGVja1NwZWNpYWxTZWxlY3Qoc2VydmljZUxpc3QpIHx8IHNlcnZpY2VMaXN0LmZpbHRlcihzZXJ2aWNlID0+IHNlcnZpY2Uua2V5VXVpZCA9PSBzZXJ2aWNlSWQpLmxlbmd0aCA+IDApKSB7XHJcbiAgICAgIHJlc3VsdCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgaXNGZWF0dXJlR3JhbnRlZEJ5TGFiZWwoc2VydmljZUxhYmVsOiBzdHJpbmcpOiBib29sZWFuIHtcclxuXHJcbiAgICBpZiAoIXRoaXMud29ya3NwYWNlU2VsZWN0ZWQpIHsgcmV0dXJuIGZhbHNlOyB9XHJcbiAgICBpZiAodGhpcy5jaGVja1NwZWNpYWxTZWxlY3QodGhpcy5nZXRQZW1pc3Npb25zKClbYCR7dGhpcy53b3Jrc3BhY2VTZWxlY3RlZH1fUEFHRVNgXSkpIHsgcmV0dXJuIHRydWUgfVxyXG4gICAgbGV0IHJlc3VsdDogYm9vbGVhblxyXG4gICAgbGV0IHNlcnZpY2VMaXN0ID0gW107XHJcbiAgICBzZXJ2aWNlTGlzdCA9IHRoaXMuZ2V0UGVtaXNzaW9ucygpW2Ake3RoaXMud29ya3NwYWNlU2VsZWN0ZWR9XyR7dGhpcy5wYWdlSWR9X1NFUlZJQ0VTUEFHRVNgXTtcclxuICAgIGlmIChzZXJ2aWNlTGlzdCAmJiBzZXJ2aWNlTGlzdC5sZW5ndGggPiAwICYmICh0aGlzLmNoZWNrU3BlY2lhbFNlbGVjdChzZXJ2aWNlTGlzdCkgfHwgc2VydmljZUxpc3QuZmlsdGVyKHNlcnZpY2UgPT4gc2VydmljZS5sYWJlbCA9PSBzZXJ2aWNlTGFiZWwpLmxlbmd0aCA+IDApKSB7XHJcbiAgICAgIHJlc3VsdCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcblxyXG4gIH1cclxuXHJcbiAgcHVibGljIGlzUGFnZUdyYW50ZWRCeUlkKHNlcnZpY2VJZDogc3RyaW5nKSB7XHJcbiAgICBsZXQgcmVzdWx0OiBib29sZWFuXHJcbiAgICBsZXQgc2VydmljZUxpc3QgPSBbXTtcclxuICAgIHNlcnZpY2VMaXN0ID0gdGhpcy5nZXRQZW1pc3Npb25zKClbYCR7dGhpcy53b3Jrc3BhY2VTZWxlY3RlZH1fJHt0aGlzLnBhZ2VJZH1fU0VSVklDRVNQQUdFU0NPTVBgXTtcclxuXHJcbiAgICBpZiAoc2VydmljZUxpc3QgJiYgc2VydmljZUxpc3QubGVuZ3RoID4gMCAmJiAodGhpcy5jaGVja1NwZWNpYWxTZWxlY3Qoc2VydmljZUxpc3QpIHx8IHNlcnZpY2VMaXN0LmZpbHRlcihzZXJ2aWNlID0+IHNlcnZpY2Uua2V5VXVpZCA9PSBzZXJ2aWNlSWQpLmxlbmd0aCA+IDApKSB7XHJcbiAgICAgIHJlc3VsdCA9IHRydWU7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXN1bHQgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIHJldHVybiByZXN1bHQ7XHJcblxyXG4gIH1cclxuXHJcbiAgZ2VuZXJhdGVGZWF0dXJlU2VjdXJpdHlQYXJhbUJvZHkocmVzb3VyY2VJZDogc3RyaW5nKSB7XHJcblxyXG4gICAgbGV0IHJlc3VsdCA9IHt9XHJcbiAgICByZXN1bHRbJ2NvbnRleHQnXSA9IHt9O1xyXG4gICAgbGV0IHVzZXJDb250ZXh0TWV0YWRhdGEgPSByZXN1bHRbJ2NvbnRleHQnXVsndXNlckNvbnRleHRNZXRhZGF0YSddID0ge307XHJcblxyXG5cclxuICAgIHVzZXJDb250ZXh0TWV0YWRhdGFbJ3VzZXJuYW1lJ10gPSB0aGlzLmdldFVzZXJOYW1lKCk7XHJcbiAgICB1c2VyQ29udGV4dE1ldGFkYXRhWydhdXRoUGVybWlzc2lvblBhdGgnXSA9IGAke3RoaXMud29ya3NwYWNlU2VsZWN0ZWR9XyR7dGhpcy5wYWdlSWR9X1NFUlZJQ0VTUEFHRVNgO1xyXG4gICAgdXNlckNvbnRleHRNZXRhZGF0YVsncmVzb3VyY2VJZCddID0gcmVzb3VyY2VJZDtcclxuICAgIHVzZXJDb250ZXh0TWV0YWRhdGFbJ3BhcmVudFR5cGUnXSA9ICdQQUdFUyc7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgfVxyXG5cclxuICBnZW5lcmF0ZUZlYXR1cmVTZWN1cml0eVBhcmFtQm9keUJ5TGFiZWwocmVzb3VyY2VMYWJlbDogc3RyaW5nKSB7XHJcbiAgICBsZXQgcmVzdWx0ID0ge31cclxuICAgIHJlc3VsdFsnY29udGV4dCddID0ge307XHJcbiAgICBsZXQgdXNlckNvbnRleHRNZXRhZGF0YSA9IHJlc3VsdFsnY29udGV4dCddWyd1c2VyQ29udGV4dE1ldGFkYXRhJ10gPSB7fTtcclxuXHJcbiAgICBjb25zdCBzZXJ2aWNlTGlzdCA9IHRoaXMuZ2V0UGVtaXNzaW9ucygpW2Ake3RoaXMud29ya3NwYWNlU2VsZWN0ZWR9XyR7dGhpcy5wYWdlSWR9X1NFUlZJQ0VTUEFHRVNgXTtcclxuXHJcbiAgICBsZXQgc2VydmljZUl0ZW0gPSBzZXJ2aWNlTGlzdCAhPSBudWxsID8gc2VydmljZUxpc3QuZmluZChzZXJ2aWNlID0+IHNlcnZpY2UubGFiZWwgPT0gcmVzb3VyY2VMYWJlbCkgOiBudWxsO1xyXG4gICAgdXNlckNvbnRleHRNZXRhZGF0YVsndXNlcm5hbWUnXSA9IHRoaXMuZ2V0VXNlck5hbWUoKTtcclxuICAgIHVzZXJDb250ZXh0TWV0YWRhdGFbJ2F1dGhQZXJtaXNzaW9uUGF0aCddID0gYCR7dGhpcy53b3Jrc3BhY2VTZWxlY3RlZH1fJHt0aGlzLnBhZ2VJZH1fU0VSVklDRVNQQUdFU2A7XHJcbiAgICB1c2VyQ29udGV4dE1ldGFkYXRhWydyZXNvdXJjZUlkJ10gPSBzZXJ2aWNlSXRlbSAhPSBudWxsID8gc2VydmljZUl0ZW0ua2V5VXVpZCA6ICcnO1xyXG4gICAgdXNlckNvbnRleHRNZXRhZGF0YVsncGFyZW50VHlwZSddID0gJ1BBR0VTJztcclxuXHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG5cclxuICB9XHJcblxyXG4gIGdlbmVyYXRlQ29tcG9zZXJQYWdlU2VjdXJpdHlQYXJhbUJvZHkocmVzb3VyY2VJZDogc3RyaW5nKSB7XHJcblxyXG4gICAgbGV0IHJlc3VsdCA9IHt9XHJcbiAgICByZXN1bHRbJ2NvbnRleHQnXSA9IHt9O1xyXG4gICAgbGV0IHVzZXJDb250ZXh0TWV0YWRhdGEgPSByZXN1bHRbJ2NvbnRleHQnXVsndXNlckNvbnRleHRNZXRhZGF0YSddID0ge307XHJcblxyXG4gICAgdXNlckNvbnRleHRNZXRhZGF0YVsndXNlcm5hbWUnXSA9IHRoaXMuZ2V0VXNlck5hbWUoKTtcclxuICAgIHVzZXJDb250ZXh0TWV0YWRhdGFbJ2F1dGhQZXJtaXNzaW9uUGF0aCddID0gYCR7dGhpcy53b3Jrc3BhY2VTZWxlY3RlZH1fJHt0aGlzLnBhZ2VJZH1TRVJWSUNFU1BBR0VTQ09NUGA7XHJcbiAgICB1c2VyQ29udGV4dE1ldGFkYXRhWydyZXNvdXJjZUlkJ10gPSByZXNvdXJjZUlkO1xyXG4gICAgdXNlckNvbnRleHRNZXRhZGF0YVsncGFyZW50VHlwZSddID0gJ1BBR0VTQ09NUCc7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuXHJcbiAgfVxyXG5cclxuICBnZXRBdXRoUGVybWlzc2lvblBhdGgoKTogc3RyaW5nIHtcclxuXHJcbiAgICByZXR1cm4gYCR7dGhpcy53b3Jrc3BhY2VTZWxlY3RlZH1fJHt0aGlzLnBhZ2VJZH1gO1xyXG5cclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRXb3JrU3BhY2UoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLndvcmtzcGFjZVNlbGVjdGVkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldFdvcmtQYWdlKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5wYWdlSWQ7XHJcbiAgfVxyXG5cclxuXHJcbiAgcHVibGljIGdldFBlbWlzc2lvbnMoKTogYW55IHtcclxuICAgIHJldHVybiB0aGlzLmdldEFDTCgpLmF1dGhQZXJtaXNzaW9ucztcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRXb3JrU3BhY2VzKCk6IEFDTFtdIHtcclxuICAgIHJldHVybiB0aGlzLmdldFBlbWlzc2lvbnMoKS5XT1JLU1BBQ0U7XHJcbiAgfVxyXG5cclxuXHJcblxyXG5cclxuICBwdWJsaWMgZ2V0RnVsbE5hbWUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmdldEFDTCgpLmZ1bGxOYW1lO1xyXG4gIH1cclxuICAvLyBzdGEgZnVvcmkgZGFsIGNvbnRlc3RvXHJcbiAgcHVibGljIGdldFJvbGVOYW1lKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBQ0woKS5ub21lUnVvbG87XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlck5hbWUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmdldEFDTCgpLnVzZXJOYW1lO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldE5vZGVCcmVhZGNydW1iKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBQ0woKS5ub2RlQnJlYWRjcnVtYjtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRSb290TmFtZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QUNMKCkucm9vdE5hbWU7XHJcbiAgfVxyXG5cclxuICBwdWJsaWMgZ2V0VXNlclVVSUQoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmdldEFDTCgpLnVzZXJVdWlkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldEtleU9pZCgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QUNMKCkua2V5T2lkO1xyXG4gIH1cclxuXHJcblxyXG5cclxuXHJcbiAgcHVibGljIGdldEVuYWJsaW5nVXVpZCgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QUNMKCkuZW5hYmxpbmdVdWlkO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldExhbmd1YWdlQ29kZSgpOiBzdHJpbmcge1xyXG4gICAgcmV0dXJuIHRoaXMuZ2V0QUNMKCkubGFuZ3VhZ2VDb2RlO1xyXG4gIH1cclxuXHJcbiAgcHVibGljIGdldENvdW50cnlDb2RlKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gdGhpcy5nZXRBQ0woKS5jb3VudHJ5Q29kZTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBnZXRUaW1lWm9uZUNvZGUoKTogc3RyaW5nIHtcclxuICAgIHJldHVybiB0aGlzLmdldEFDTCgpLnRpbWVab25lQ29kZTtcclxuICB9XHJcblxyXG5cclxuXHJcbiAgcHVibGljIGdldEFDTCgpIDogSVVzZXJJbmZvIHtcclxuICAgIHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGxvY2FsU3RvcmFuZ2VBQ0xLZXkpKTtcclxuICB9XHJcblxyXG4gIHB1YmxpYyBzZXRBQ0xMb2NhbFN0b3JhZ2UocmV2b0NvbnRleHQ6IGFueSkge1xyXG5cclxuXHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShsb2NhbFN0b3JhbmdlQUNMS2V5LCBKU09OLnN0cmluZ2lmeSh0aGlzLmNyZWF0ZVVzZXJJbmZvKHJldm9Db250ZXh0KSkpO1xyXG4gIH1cclxuXHJcblxyXG4gIHByaXZhdGUgY3JlYXRlVXNlckluZm8ocmV2b0NvbnRleHQ6IGFueSk6IElVc2VySW5mbyB7XHJcblxyXG4gICAgY29uc3QgdXNlckNvbnRleHRNZXRhZGF0YSA9IHJldm9Db250ZXh0LmNvbnRleHQudXNlckNvbnRleHRNZXRhZGF0YTtcclxuICAgIGNvbnN0IGNvbnRleHQgPSByZXZvQ29udGV4dC5jb250ZXh0O1xyXG5cclxuXHJcbiAgICBjb25zdCBwZXJtaXNzaW9uc0FuZFVzZXJJbmZvOiBJVXNlckluZm8gPSB7XHJcblxyXG4gICAgICBhdXRoUGVybWlzc2lvbnM6IEpTT04ucGFyc2UodXNlckNvbnRleHRNZXRhZGF0YS5hdXRoUGVybWlzc2lvbnMpLFxyXG4gICAgICBrZXlPaWQ6IHVzZXJDb250ZXh0TWV0YWRhdGEua2V5T2lkLFxyXG4gICAgICByb290TmFtZTogdXNlckNvbnRleHRNZXRhZGF0YS5yb290TmFtZSxcclxuICAgICAgdXNlclV1aWQ6IHVzZXJDb250ZXh0TWV0YWRhdGEudXNlclV1aWQsXHJcbiAgICAgIGZ1bGxOYW1lOiB1c2VyQ29udGV4dE1ldGFkYXRhLmZ1bGxOYW1lLFxyXG4gICAgICB1c2VyTmFtZTogY29udGV4dC51c2VyTmFtZSxcclxuICAgICAgbm9tZVJ1b2xvOiBjb250ZXh0Lm5vbWVSdW9sbyxcclxuICAgICAgbm9kZUJyZWFkY3J1bWI6IHVzZXJDb250ZXh0TWV0YWRhdGEubm9kZUJyZWFkY3J1bWIsXHJcbiAgICAgIGVuYWJsaW5nVXVpZCA6IHVzZXJDb250ZXh0TWV0YWRhdGEuZW5hYmxpbmdVdWlkLFxyXG4gICAgICBjb3VudHJ5Q29kZSAgOiB1c2VyQ29udGV4dE1ldGFkYXRhLmNvdW50cnlDb2RlLFxyXG4gICAgICBsYW5ndWFnZUNvZGUgOiB1c2VyQ29udGV4dE1ldGFkYXRhLmxhbmd1YWdlQ29kZSxcclxuICAgICAgdGltZVpvbmVDb2RlICA6IHVzZXJDb250ZXh0TWV0YWRhdGEudGltZVpvbmVDb2RlXHJcbiAgICAgXHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHBlcm1pc3Npb25zQW5kVXNlckluZm87XHJcblxyXG4gIH1cclxuXHJcblxyXG5cclxuLyogICBwdWJsaWMgc2V0UGVybWlzc2lvbnNBbmRVc2VySW5mbyh1c2VySW5mbzogSVVzZXJJbmZvKSB7XHJcbiAgICB0aGlzLnN0b3JlJC5kaXNwYXRjaChzZXRQZXJtaXNzaW9uc0FuZFVzZXJJbmZvKHsgdXNlckluZm86IHVzZXJJbmZvIH0pKTtcclxuICB9ICovXHJcblxyXG4gIHB1YmxpYyBzZXROZXdUb2tlbih0b2tlbjogU3RyaW5nKSB7XHJcblxyXG4gICAgY29uc3QgdG9rZW5JbmZvID0ge1xyXG4gICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG4gICAgICBuYW1lOiBcIm5iOmF1dGg6c2ltcGxlOnRva2VuXCIsXHJcbiAgICAgIG93bmVyU3RyYXRlZ3lOYW1lOiBcInVzZXJuYW1lXCIsXHJcbiAgICAgIHZhbHVlOiB0b2tlbixcclxuICAgIH1cclxuXHJcbiAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnYXV0aF9hcHBfdG9rZW4nLCBKU09OLnN0cmluZ2lmeSh0b2tlbkluZm8pKTtcclxuICB9XHJcblxyXG5cclxuXHJcblxyXG4gIHByaXZhdGUgZ2V0RmVhdHVyZUlkQnlGZWF0dXJlTGFiZWwoZmVhdHVyZUxhYmVsOiBzdHJpbmcpIHtcclxuICAgIGxldCByZXN1bHQgPSBqc29uUXVlcnkuZGVmYXVsdChgJHt0aGlzLndvcmtzcGFjZVNlbGVjdGVkfV9QQUdFU1tsYWJlbD0ke2ZlYXR1cmVMYWJlbH1dLmtleVV1aWRgLCB7XHJcbiAgICAgIGRhdGE6IHRoaXMuZ2V0UGVtaXNzaW9ucygpXHJcbiAgICB9KVxyXG5cclxuICAgIHJldHVybiByZXN1bHQudmFsdWU7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIGNoZWNrU3BlY2lhbFNlbGVjdChzZXJ2aWNlTGlzdDogYW55W10pOiBib29sZWFuIHtcclxuICAgIHJldHVybiBhbGxvd2VkLmluY2x1ZGVzKHNlcnZpY2VMaXN0WzBdLmxhYmVsKTtcclxuICB9XHJcblxyXG59XHJcbiJdfQ==